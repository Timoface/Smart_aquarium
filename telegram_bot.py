import dotenv
from os import getenv
import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton

import commands

dotenv.load_dotenv()
TOKEN = getenv("TOKEN")
bot = telebot.TeleBot(TOKEN)


@bot.message_handler(commands=['start'])
def start(message):
    start_message = ("<b>–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–º–Ω—ã–º –∞–∫–≤–∞—Ä–∏—É–º–æ–º! üêü\n"
                     "–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å! üëá</b>")

    markup = InlineKeyboardMarkup()
    markup.add(InlineKeyboardButton(
        text="–ü–æ–∫–æ—Ä–º–∏—Ç—å —Ä—ã–±–æ–∫ ü•¨",
        callback_data="feed"
    ))
    markup.add(InlineKeyboardButton(
        text="–£–∑–Ω–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–¥—ã üå°",
        callback_data="temperature"
    ))
    markup.add(InlineKeyboardButton(
        text="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç üí°",
        callback_data="light"
    ))

    bot.send_message(
        text=start_message,
        parse_mode="HTML",
        chat_id=message.chat.id,
        reply_markup=markup
    )


@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    if call.data == "feed":
        feed_markup = InlineKeyboardMarkup()
        feed_markup.add(InlineKeyboardButton(
            text="–ü–æ–∫–æ—Ä–º–∏—Ç—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ä—ã–±–æ–∫ üêü",
            callback_data="feed_small"
        ))
        feed_markup.add(InlineKeyboardButton(
            text="–ü–æ–∫–æ—Ä–º–∏—Ç—å –±–æ–ª—å—à–∏—Ö —Ä—ã–±–æ–∫ üê†",
            callback_data="feed_big"
        ))

        bot.edit_message_text(
            chat_id=call.message.chat.id,
            message_id=call.message.message_id,
            text="<b>üóí –í—ã–±–µ—Ä–∏, –∫–æ–≥–æ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–∫–æ—Ä–º–∏—Ç—å:</b>",
            reply_markup=feed_markup,
            parse_mode="HTML"
        )
    elif call.data == "feed_small":
        bot.answer_callback_query(call.id, "–ú–∞–ª–µ–Ω—å–∫–∏–µ —Ä—ã–±–∫–∏ –Ω–∞–∫–æ—Ä–º–ª–µ–Ω—ã! üêüü•¨")
        commands.feed_small()
    elif call.data == "feed_big":
        bot.answer_callback_query(call.id, "–ë–æ–ª—å—à–∏–µ —Ä—ã–±–∫–∏ –Ω–∞–∫–æ—Ä–º–ª–µ–Ω—ã! üê†ü•¨")
        commands.feed_big()
    elif call.data == "temperature":
        temperature = commands.temperature()
        bot.answer_callback_query(call.id, f"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: {temperature}¬∞C üå°")
    elif call.data == "light":
        bot.answer_callback_query(call.id, "–°–≤–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω! üí°")
        commands.light()


if __name__ == '__main__':
    bot.infinity_polling()
